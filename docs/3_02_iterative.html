<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Data Processing &amp; Visualization</title>
  <meta name="description" content="The focus of this document is on common data processing and exploration techniques in R, especially as a prelude to visualization. Part of the focus will be on the dplyr and tidyverse packages, which enhance and facilitate the sorts of operations that typically arise when dealing with data, including faster I/O and grouped operations. For visualization, the focus will be on using ggplot2 and other packages that allow for interactivity. Exercises may be found in the document as well. In addition, the demonstrations of the data processing section are available in Python via Jupyter notebooks.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Data Processing &amp; Visualization" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://m-clark.github.io/data-processing-and-visualization/" />
  <meta property="og:image" content="https://m-clark.github.io/data-processing-and-visualization/img/nineteeneightyR.png" />
  <meta property="og:description" content="The focus of this document is on common data processing and exploration techniques in R, especially as a prelude to visualization. Part of the focus will be on the dplyr and tidyverse packages, which enhance and facilitate the sorts of operations that typically arise when dealing with data, including faster I/O and grouped operations. For visualization, the focus will be on using ggplot2 and other packages that allow for interactivity. Exercises may be found in the document as well. In addition, the demonstrations of the data processing section are available in Python via Jupyter notebooks." />
  <meta name="github-repo" content="m-clark/data-processing-and-visualization/" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Data Processing &amp; Visualization" />
  
  <meta name="twitter:description" content="The focus of this document is on common data processing and exploration techniques in R, especially as a prelude to visualization. Part of the focus will be on the dplyr and tidyverse packages, which enhance and facilitate the sorts of operations that typically arise when dealing with data, including faster I/O and grouped operations. For visualization, the focus will be on using ggplot2 and other packages that allow for interactivity. Exercises may be found in the document as well. In addition, the demonstrations of the data processing section are available in Python via Jupyter notebooks." />
  <meta name="twitter:image" content="https://m-clark.github.io/data-processing-and-visualization/img/nineteeneightyR.png" />



<meta name="date" content="2018-07-22">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  <link rel="shortcut icon" href="img/R.ico" type="image/x-icon">
<link rel="prev" href="3_01_programming.html">
<link rel="next" href="3_03_functions.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.2/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.7.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="libs/plotlyjs-1.29.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotlyjs-1.29.2/plotly-latest.min.js"></script>
<link href="libs/vis-4.20.1/vis.css" rel="stylesheet" />
<script src="libs/vis-4.20.1/vis.min.js"></script>
<script src="libs/visNetwork-binding-2.0.4/visNetwork.js"></script>
<script src="libs/proj4js-2.3.15/proj4.js"></script>
<link href="libs/highcharts-5.0.6/css/motion.css" rel="stylesheet" />
<script src="libs/highcharts-5.0.6/highstock.js"></script>
<script src="libs/highcharts-5.0.6/highcharts-3d.js"></script>
<script src="libs/highcharts-5.0.6/highcharts-more.js"></script>
<script src="libs/highcharts-5.0.6/modules/annotations.js"></script>
<script src="libs/highcharts-5.0.6/modules/broken-axis.js"></script>
<script src="libs/highcharts-5.0.6/modules/data.js"></script>
<script src="libs/highcharts-5.0.6/modules/drilldown.js"></script>
<script src="libs/highcharts-5.0.6/modules/exporting.js"></script>
<script src="libs/highcharts-5.0.6/modules/funnel.js"></script>
<script src="libs/highcharts-5.0.6/modules/heatmap.js"></script>
<script src="libs/highcharts-5.0.6/modules/map.js"></script>
<script src="libs/highcharts-5.0.6/modules/no-data-to-display.js"></script>
<script src="libs/highcharts-5.0.6/modules/offline-exporting.js"></script>
<script src="libs/highcharts-5.0.6/modules/solid-gauge.js"></script>
<script src="libs/highcharts-5.0.6/modules/treemap.js"></script>
<script src="libs/highcharts-5.0.6/plugins/annotations.js"></script>
<script src="libs/highcharts-5.0.6/plugins/draggable-legend.js"></script>
<script src="libs/highcharts-5.0.6/plugins/draggable-points.js"></script>
<script src="libs/highcharts-5.0.6/plugins/export-csv.js"></script>
<script src="libs/highcharts-5.0.6/plugins/grouped-categories.js"></script>
<script src="libs/highcharts-5.0.6/plugins/motion.js"></script>
<script src="libs/highcharts-5.0.6/plugins/pattern-fill-v2.js"></script>
<script src="libs/highcharts-5.0.6/plugins/tooltip-delay.js"></script>
<script src="libs/highcharts-5.0.6/custom/reset.js"></script>
<script src="libs/highcharts-5.0.6/custom/symbols-extra.js"></script>
<script src="libs/highcharts-5.0.6/custom/text-symbols.js"></script>
<link href="libs/fontawesome-4.5.0/font-awesome.min.css" rel="stylesheet" />
<link href="libs/htmlwdgtgrid-1/htmlwdgtgrid.css" rel="stylesheet" />
<script src="libs/highchart-binding-0.5.0/highchart.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.1/leaflet.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.4/datatables.js"></script>
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.16/js/jquery.dataTables.min.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/standard_html.css" type="text/css" />
<link rel="stylesheet" href="css/book.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class='before'><a href="https://m-clark.github.io/">Data Processing & Visualization</a></li>

<li class="divider"></li>
<li><a href="index.html#section"></a></li>
<li class="chapter" data-level="" data-path="1_01_intro.html"><a href="1_01_intro.html"><i class="fa fa-check"></i>Intro</a><ul>
<li class="chapter" data-level="" data-path="1_01_intro.html"><a href="1_01_intro.html#outline"><i class="fa fa-check"></i>Outline</a><ul>
<li class="chapter" data-level="" data-path="1_01_intro.html"><a href="1_01_intro.html#part-1-data-processing"><i class="fa fa-check"></i>Part 1: Data Processing</a></li>
<li class="chapter" data-level="" data-path="1_01_intro.html"><a href="1_01_intro.html#part-2-visualization"><i class="fa fa-check"></i>Part 2: Visualization</a></li>
<li class="chapter" data-level="" data-path="1_01_intro.html"><a href="1_01_intro.html#part-3-programming-basics"><i class="fa fa-check"></i>Part 3: Programming Basics</a></li>
<li class="chapter" data-level="" data-path="1_01_intro.html"><a href="1_01_intro.html#part-4-presentation"><i class="fa fa-check"></i>Part 4: Presentation</a></li>
<li class="chapter" data-level="" data-path="1_01_intro.html"><a href="1_01_intro.html#part-5-modeling"><i class="fa fa-check"></i>Part 5: Modeling</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="1_01_intro.html"><a href="1_01_intro.html#preparation"><i class="fa fa-check"></i>Preparation</a></li>
<li class="chapter" data-level="" data-path="1_01_intro.html"><a href="1_01_intro.html#other"><i class="fa fa-check"></i>Other</a></li>
<li class="chapter" data-level="" data-path="1_01_intro.html"><a href="1_01_intro.html#python"><i class="fa fa-check"></i>Python</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="1_02_dataStructures.html"><a href="1_02_dataStructures.html"><i class="fa fa-check"></i>Part I: Data Processing</a><ul>
<li class="chapter" data-level="" data-path="1_02_dataStructures.html"><a href="1_02_dataStructures.html#data-structures"><i class="fa fa-check"></i>Data Structures</a><ul>
<li class="chapter" data-level="" data-path="1_02_dataStructures.html"><a href="1_02_dataStructures.html#vectors"><i class="fa fa-check"></i>Vectors</a></li>
<li class="chapter" data-level="" data-path="1_02_dataStructures.html"><a href="1_02_dataStructures.html#matrices"><i class="fa fa-check"></i>Matrices</a></li>
<li class="chapter" data-level="" data-path="1_02_dataStructures.html"><a href="1_02_dataStructures.html#lists"><i class="fa fa-check"></i>Lists</a></li>
<li class="chapter" data-level="" data-path="1_02_dataStructures.html"><a href="1_02_dataStructures.html#data-frames"><i class="fa fa-check"></i>Data Frames</a></li>
<li><a href="1_02_dataStructures.html#data-structure-exercises"><strong>Data Structure Exercises</strong></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="1_03_io.html"><a href="1_03_io.html"><i class="fa fa-check"></i>Input/Output</a><ul>
<li class="chapter" data-level="" data-path="1_03_io.html"><a href="1_03_io.html#other-approaches"><i class="fa fa-check"></i>Other approaches</a></li>
<li class="chapter" data-level="" data-path="1_03_io.html"><a href="1_03_io.html#faster-approaches"><i class="fa fa-check"></i>Faster approaches</a></li>
<li class="chapter" data-level="" data-path="1_03_io.html"><a href="1_03_io.html#other-data"><i class="fa fa-check"></i>Other Data</a></li>
<li class="chapter" data-level="" data-path="1_03_io.html"><a href="1_03_io.html#on-the-horizon"><i class="fa fa-check"></i>On the horizon</a></li>
<li class="chapter" data-level="" data-path="1_03_io.html"><a href="1_03_io.html#big-data"><i class="fa fa-check"></i>Big Data</a></li>
<li><a href="1_03_io.html#io-exercises"><strong>I/O Exercises</strong></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="1_04_indexing.html"><a href="1_04_indexing.html"><i class="fa fa-check"></i>Indexing</a><ul>
<li class="chapter" data-level="" data-path="1_04_indexing.html"><a href="1_04_indexing.html#base-r-indexing-refresher"><i class="fa fa-check"></i>Base R Indexing Refresher</a></li>
<li class="chapter" data-level="" data-path="1_04_indexing.html"><a href="1_04_indexing.html#listdata.frame-extraction"><i class="fa fa-check"></i>List/Data.frame extraction</a></li>
<li><a href="1_04_indexing.html#indexing-exercises"><strong>Indexing Exercises</strong></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="1_05_pipes.html"><a href="1_05_pipes.html"><i class="fa fa-check"></i>Pipes</a><ul>
<li class="chapter" data-level="" data-path="1_05_pipes.html"><a href="1_05_pipes.html#pipes-for-visualization-more-later"><i class="fa fa-check"></i>Pipes for Visualization (more later)</a></li>
<li class="chapter" data-level="" data-path="1_05_pipes.html"><a href="1_05_pipes.html#the-dot"><i class="fa fa-check"></i>The dot</a></li>
<li class="chapter" data-level="" data-path="1_05_pipes.html"><a href="1_05_pipes.html#flexibility"><i class="fa fa-check"></i>Flexibility</a></li>
<li class="chapter" data-level="" data-path="1_05_pipes.html"><a href="1_05_pipes.html#summary"><i class="fa fa-check"></i>Summary</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="1_06_tidyverse.html"><a href="1_06_tidyverse.html"><i class="fa fa-check"></i>Tidyverse</a><ul>
<li class="chapter" data-level="" data-path="1_06_tidyverse.html"><a href="1_06_tidyverse.html#what-is-the-tidyverse"><i class="fa fa-check"></i>What is the tidyverse?</a></li>
<li class="chapter" data-level="" data-path="1_06_tidyverse.html"><a href="1_06_tidyverse.html#what-is-tidy"><i class="fa fa-check"></i>What is tidy?</a></li>
<li class="chapter" data-level="" data-path="1_06_tidyverse.html"><a href="1_06_tidyverse.html#dplyr"><i class="fa fa-check"></i>dplyr</a></li>
<li class="chapter" data-level="" data-path="1_06_tidyverse.html"><a href="1_06_tidyverse.html#running-example"><i class="fa fa-check"></i>Running example</a></li>
<li class="chapter" data-level="" data-path="1_06_tidyverse.html"><a href="1_06_tidyverse.html#selecting-columns"><i class="fa fa-check"></i>Selecting Columns</a></li>
<li class="chapter" data-level="" data-path="1_06_tidyverse.html"><a href="1_06_tidyverse.html#filtering-rows"><i class="fa fa-check"></i>Filtering Rows</a></li>
<li class="chapter" data-level="" data-path="1_06_tidyverse.html"><a href="1_06_tidyverse.html#generating-new-data"><i class="fa fa-check"></i>Generating New Data</a></li>
<li class="chapter" data-level="" data-path="1_06_tidyverse.html"><a href="1_06_tidyverse.html#grouping-and-summarizing-data"><i class="fa fa-check"></i>Grouping and Summarizing Data</a></li>
<li class="chapter" data-level="" data-path="1_06_tidyverse.html"><a href="1_06_tidyverse.html#renaming-columns"><i class="fa fa-check"></i>Renaming columns</a></li>
<li class="chapter" data-level="" data-path="1_06_tidyverse.html"><a href="1_06_tidyverse.html#merging-data"><i class="fa fa-check"></i>Merging Data</a></li>
<li class="chapter" data-level="" data-path="1_06_tidyverse.html"><a href="1_06_tidyverse.html#tidyr"><i class="fa fa-check"></i>tidyr</a></li>
<li class="chapter" data-level="" data-path="1_06_tidyverse.html"><a href="1_06_tidyverse.html#more-tidyverse"><i class="fa fa-check"></i>More Tidyverse</a></li>
<li class="chapter" data-level="" data-path="1_06_tidyverse.html"><a href="1_06_tidyverse.html#personal-opinion"><i class="fa fa-check"></i>Personal Opinion</a></li>
<li><a href="1_06_tidyverse.html#tidyverse-exercises"><strong>tidyverse Exercises</strong></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="1_07_datatable.html"><a href="1_07_datatable.html"><i class="fa fa-check"></i>data.table</a><ul>
<li class="chapter" data-level="" data-path="1_07_datatable.html"><a href="1_07_datatable.html#basics"><i class="fa fa-check"></i>Basics</a></li>
<li class="chapter" data-level="" data-path="1_07_datatable.html"><a href="1_07_datatable.html#grouped-operations"><i class="fa fa-check"></i>Grouped operations</a></li>
<li class="chapter" data-level="" data-path="1_07_datatable.html"><a href="1_07_datatable.html#faster"><i class="fa fa-check"></i>Faster!</a></li>
<li class="chapter" data-level="" data-path="1_07_datatable.html"><a href="1_07_datatable.html#pipe-with-data.table"><i class="fa fa-check"></i>Pipe with data.table</a></li>
<li class="chapter" data-level="" data-path="1_07_datatable.html"><a href="1_07_datatable.html#summary-1"><i class="fa fa-check"></i>Summary</a></li>
<li class="chapter" data-level="" data-path="1_07_datatable.html"><a href="1_07_datatable.html#dtplyr"><i class="fa fa-check"></i>dtplyr</a></li>
<li><a href="1_07_datatable.html#data.table-exercises"><strong>data.table Exercises</strong></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="2_01_thinkingvis.html"><a href="2_01_thinkingvis.html"><i class="fa fa-check"></i>Part II: Visualization</a><ul>
<li class="chapter" data-level="" data-path="2_01_thinkingvis.html"><a href="2_01_thinkingvis.html#thinking-visually-1"><i class="fa fa-check"></i>Thinking Visually</a><ul>
<li class="chapter" data-level="" data-path="2_01_thinkingvis.html"><a href="2_01_thinkingvis.html#information"><i class="fa fa-check"></i>Information</a></li>
<li class="chapter" data-level="" data-path="2_01_thinkingvis.html"><a href="2_01_thinkingvis.html#color"><i class="fa fa-check"></i>Color</a></li>
<li class="chapter" data-level="" data-path="2_01_thinkingvis.html"><a href="2_01_thinkingvis.html#contrast"><i class="fa fa-check"></i>Contrast</a></li>
<li class="chapter" data-level="" data-path="2_01_thinkingvis.html"><a href="2_01_thinkingvis.html#scaling-size"><i class="fa fa-check"></i>Scaling Size</a></li>
<li class="chapter" data-level="" data-path="2_01_thinkingvis.html"><a href="2_01_thinkingvis.html#transparency"><i class="fa fa-check"></i>Transparency</a></li>
<li class="chapter" data-level="" data-path="2_01_thinkingvis.html"><a href="2_01_thinkingvis.html#accessibility"><i class="fa fa-check"></i>Accessibility</a></li>
<li class="chapter" data-level="" data-path="2_01_thinkingvis.html"><a href="2_01_thinkingvis.html#file-types"><i class="fa fa-check"></i>File Types</a></li>
<li class="chapter" data-level="" data-path="2_01_thinkingvis.html"><a href="2_01_thinkingvis.html#summary-2"><i class="fa fa-check"></i>Summary</a></li>
<li class="chapter" data-level="" data-path="2_01_thinkingvis.html"><a href="2_01_thinkingvis.html#a-casual-list-of-things-to-avoid"><i class="fa fa-check"></i>A casual list of things to avoid</a></li>
<li class="chapter" data-level="" data-path="2_01_thinkingvis.html"><a href="2_01_thinkingvis.html#thinking-visually-exercises"><i class="fa fa-check"></i>Thinking Visually Exercises</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="2_02_ggplot2.html"><a href="2_02_ggplot2.html"><i class="fa fa-check"></i>ggplot2</a><ul>
<li class="chapter" data-level="" data-path="2_02_ggplot2.html"><a href="2_02_ggplot2.html#layers"><i class="fa fa-check"></i>Layers</a></li>
<li class="chapter" data-level="" data-path="2_02_ggplot2.html"><a href="2_02_ggplot2.html#piping"><i class="fa fa-check"></i>Piping</a></li>
<li class="chapter" data-level="" data-path="2_02_ggplot2.html"><a href="2_02_ggplot2.html#aesthetics"><i class="fa fa-check"></i>Aesthetics</a></li>
<li class="chapter" data-level="" data-path="2_02_ggplot2.html"><a href="2_02_ggplot2.html#examples"><i class="fa fa-check"></i>Examples</a></li>
<li class="chapter" data-level="" data-path="2_02_ggplot2.html"><a href="2_02_ggplot2.html#stats"><i class="fa fa-check"></i>Stats</a></li>
<li class="chapter" data-level="" data-path="2_02_ggplot2.html"><a href="2_02_ggplot2.html#scales"><i class="fa fa-check"></i>Scales</a></li>
<li class="chapter" data-level="" data-path="2_02_ggplot2.html"><a href="2_02_ggplot2.html#facets"><i class="fa fa-check"></i>Facets</a></li>
<li class="chapter" data-level="" data-path="2_02_ggplot2.html"><a href="2_02_ggplot2.html#fine-control"><i class="fa fa-check"></i>Fine control</a></li>
<li class="chapter" data-level="" data-path="2_02_ggplot2.html"><a href="2_02_ggplot2.html#themes"><i class="fa fa-check"></i>Themes</a></li>
<li class="chapter" data-level="" data-path="2_02_ggplot2.html"><a href="2_02_ggplot2.html#extensions"><i class="fa fa-check"></i>Extensions</a></li>
<li class="chapter" data-level="" data-path="2_02_ggplot2.html"><a href="2_02_ggplot2.html#summary-ggplot2"><i class="fa fa-check"></i>Summary ggplot2</a></li>
<li><a href="2_02_ggplot2.html#ggplot2-exercises"><strong>ggplot2 Exercises</strong></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="2_03_interactive.html"><a href="2_03_interactive.html"><i class="fa fa-check"></i>Interactive Visualization</a><ul>
<li class="chapter" data-level="" data-path="2_03_interactive.html"><a href="2_03_interactive.html#packages"><i class="fa fa-check"></i>Packages</a></li>
<li class="chapter" data-level="" data-path="2_03_interactive.html"><a href="2_03_interactive.html#piping-for-visualization"><i class="fa fa-check"></i>Piping for Visualization</a></li>
<li class="chapter" data-level="" data-path="2_03_interactive.html"><a href="2_03_interactive.html#htmlwidgets"><i class="fa fa-check"></i>htmlwidgets</a></li>
<li class="chapter" data-level="" data-path="2_03_interactive.html"><a href="2_03_interactive.html#plotly"><i class="fa fa-check"></i>Plotly</a></li>
<li class="chapter" data-level="" data-path="2_03_interactive.html"><a href="2_03_interactive.html#highcharter"><i class="fa fa-check"></i>Highcharter</a></li>
<li class="chapter" data-level="" data-path="2_03_interactive.html"><a href="2_03_interactive.html#visnetwork"><i class="fa fa-check"></i>visNetwork</a></li>
<li class="chapter" data-level="" data-path="2_03_interactive.html"><a href="2_03_interactive.html#leaflet"><i class="fa fa-check"></i>leaflet</a></li>
<li class="chapter" data-level="" data-path="2_03_interactive.html"><a href="2_03_interactive.html#dt"><i class="fa fa-check"></i>DT</a></li>
<li class="chapter" data-level="" data-path="2_03_interactive.html"><a href="2_03_interactive.html#shiny"><i class="fa fa-check"></i>Shiny</a></li>
<li class="chapter" data-level="" data-path="2_03_interactive.html"><a href="2_03_interactive.html#interactive-and-visual-data-exploration"><i class="fa fa-check"></i>Interactive and Visual Data Exploration</a></li>
<li><a href="2_03_interactive.html#interactive-visualization-exercises"><strong>Interactive Visualization Exercises</strong></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="3_01_programming.html"><a href="3_01_programming.html"><i class="fa fa-check"></i>Part III: Programming</a><ul>
<li class="chapter" data-level="" data-path="3_01_programming.html"><a href="3_01_programming.html#basics-1"><i class="fa fa-check"></i>Basics</a><ul>
<li class="chapter" data-level="" data-path="3_01_programming.html"><a href="3_01_programming.html#r-objects"><i class="fa fa-check"></i>R Objects</a></li>
<li class="chapter" data-level="" data-path="3_01_programming.html"><a href="3_01_programming.html#help-files"><i class="fa fa-check"></i>Help Files</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="3_02_iterative.html"><a href="3_02_iterative.html"><i class="fa fa-check"></i>Iterative Programming</a><ul>
<li class="chapter" data-level="" data-path="3_02_iterative.html"><a href="3_02_iterative.html#for-loops"><i class="fa fa-check"></i>For loops</a></li>
<li class="chapter" data-level="" data-path="3_02_iterative.html"><a href="3_02_iterative.html#while-alternative"><i class="fa fa-check"></i>While alternative</a></li>
<li class="chapter" data-level="" data-path="3_02_iterative.html"><a href="3_02_iterative.html#dots-and-loops"><i class="fa fa-check"></i>(Dots and) Loops</a></li>
<li class="chapter" data-level="" data-path="3_02_iterative.html"><a href="3_02_iterative.html#apply-family"><i class="fa fa-check"></i>apply family</a></li>
<li class="chapter" data-level="" data-path="3_02_iterative.html"><a href="3_02_iterative.html#purrr"><i class="fa fa-check"></i>purrr</a></li>
<li class="chapter" data-level="" data-path="3_02_iterative.html"><a href="3_02_iterative.html#working-with-lists"><i class="fa fa-check"></i>Working with lists</a></li>
<li class="chapter" data-level="" data-path="3_02_iterative.html"><a href="3_02_iterative.html#iterative-programming-exercises"><i class="fa fa-check"></i>Iterative Programming Exercises</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="3_03_functions.html"><a href="3_03_functions.html"><i class="fa fa-check"></i>Writing functions</a><ul>
<li class="chapter" data-level="" data-path="3_03_functions.html"><a href="3_03_functions.html#a-starting-point"><i class="fa fa-check"></i>A starting point</a></li>
<li class="chapter" data-level="" data-path="3_03_functions.html"><a href="3_03_functions.html#dry"><i class="fa fa-check"></i>DRY</a></li>
<li class="chapter" data-level="" data-path="3_03_functions.html"><a href="3_03_functions.html#lambda-functions"><i class="fa fa-check"></i>Lambda functions</a></li>
<li class="chapter" data-level="" data-path="3_03_functions.html"><a href="3_03_functions.html#writing-functions-exercises"><i class="fa fa-check"></i>Writing Functions Exercises</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="3_04_more.html"><a href="3_04_more.html"><i class="fa fa-check"></i>More</a><ul>
<li class="chapter" data-level="" data-path="3_04_more.html"><a href="3_04_more.html#vectorization"><i class="fa fa-check"></i>Vectorization</a></li>
<li class="chapter" data-level="" data-path="3_04_more.html"><a href="3_04_more.html#regular-expressions"><i class="fa fa-check"></i>Regular Expressions</a></li>
<li><a href="3_04_more.html#vector-exercises"><strong>Vector Exercises</strong></a></li>
<li><a href="3_04_more.html#regex-exercises"><strong>Regex Exercises</strong></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="999_summary.html"><a href="999_summary.html"><i class="fa fa-check"></i>Summary</a></li>
<li class="divider"></li>
<li class='after'><a href="https://m-clark.github.io/"><img src="img/mc.png" style="width:50%; padding:0px 0; display:block; margin: 0 auto;" alt="MC logo"></a></li>
<li class='after'><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="width:50%; border-width:0; display:block; margin: 0 auto;" src="img/ccbysa.png" /></a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Processing &amp; Visualization</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="iterative-programming" class="section level2">
<h2>Iterative Programming</h2>
<p>Almost everything you do when dealing with data will need to be done again, and again, and again. If you are copy-pasting your way to repetitively do the same thing, you’re not only doing things inefficiently, you’re almost certainly setting yourself up for trouble if practically anything changes about the data or process.</p>
<p>In order to avoid this, you need to be familiar with basic programming, and a starting point is to use iterative programming. Let’s look at the following. Let’s say we want to get the means of some columns in our data set. Do you do something like this?</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb257-1" data-line-number="1">means1 =<span class="st"> </span><span class="kw">mean</span>(df<span class="op">$</span>x)</a>
<a class="sourceLine" id="cb257-2" data-line-number="2">means2 =<span class="st"> </span><span class="kw">mean</span>(df<span class="op">$</span>y)</a>
<a class="sourceLine" id="cb257-3" data-line-number="3">means3 =<span class="st"> </span><span class="kw">mean</span>(df<span class="op">$</span>z)</a>
<a class="sourceLine" id="cb257-4" data-line-number="4">means4 =<span class="st"> </span><span class="kw">mean</span>(df<span class="op">$</span>q)</a></code></pre></div>
<p>Now consider what you have to change if you change a variable name, decide to do a median, or the data object name changes. Practically breathing on the data will cause you to have to redo that code, and possibly every line of it.</p>
<div id="for-loops" class="section level3">
<h3>For loops</h3>
<p>A <span class="emph">for loop</span> will help us get around the problem. The idea is that we want to perform a particular action <em>for</em> every iteration of some sequence. That sequence may be over columns, rows, lines in a text, whatever. Here is a loop.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb258-1" data-line-number="1"><span class="cf">for</span> (column <span class="cf">in</span> <span class="kw">c</span>(<span class="st">&#39;x&#39;</span>,<span class="st">&#39;y&#39;</span>,<span class="st">&#39;z&#39;</span>,<span class="st">&#39;q&#39;</span>)) {</a>
<a class="sourceLine" id="cb258-2" data-line-number="2">  <span class="kw">mean</span>(df[,column])</a>
<a class="sourceLine" id="cb258-3" data-line-number="3">}</a></code></pre></div>
<p>What’s going on here? We’ve created an iterative process in which, <em>for</em> every element in <code>c('x','y','z','q')</code>, we are going to do something. We use the completely arbitrary word <code>column</code> as a placeholder to index which of the four columns we’re dealing with at a given point in the process. On the first iteration, <code>column</code> will equal <code>x</code>, on the second <code>y</code>, and so on. We then take the mean of <code>df[,column]</code>, which will be <code>df[,'x']</code>, then <code>df[,'y']</code>, etc.</p>
<p>Here is an example with the <span class="pack">nycflights</span> data, which regards flights that departed New York City in 2013. The <span class="objclass">weather</span> data set has columns for things like temperature, humidity, and so forth.<a href="#fn21" class="footnote-ref" id="fnref21"><sup>21</sup></a></p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb259-1" data-line-number="1">weather =<span class="st"> </span><span class="kw">data.frame</span>(nycflights13<span class="op">::</span>weather)</a>
<a class="sourceLine" id="cb259-2" data-line-number="2"></a>
<a class="sourceLine" id="cb259-3" data-line-number="3"><span class="cf">for</span> (column <span class="cf">in</span> <span class="kw">c</span>(<span class="st">&#39;temp&#39;</span>,<span class="st">&#39;humid&#39;</span>,<span class="st">&#39;wind_speed&#39;</span>,<span class="st">&#39;precip&#39;</span>)) {</a>
<a class="sourceLine" id="cb259-4" data-line-number="4">  <span class="kw">print</span>(<span class="kw">mean</span>(weather[,column], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb259-5" data-line-number="5">}</a></code></pre></div>
<pre><code>[1] 55.26039
[1] 62.53006
[1] 10.51749
[1] 0.004469079</code></pre>
<p>Now if the data name changes, the columns we want change, or we want to calculate something else, we usually end up only changing one thing, rather than <em>at least</em> changing one, and probably many more things. In addition, the amount of code is the same whether the loop goes over 100 columns or 4.</p>
<p>Let’s do things a little differently.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb261-1" data-line-number="1">columns =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;temp&#39;</span>, <span class="st">&#39;humid&#39;</span>, <span class="st">&#39;wind_speed&#39;</span>, <span class="st">&#39;precip&#39;</span>)</a>
<a class="sourceLine" id="cb261-2" data-line-number="2">nyc_means =<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, <span class="kw">length</span>(columns))</a>
<a class="sourceLine" id="cb261-3" data-line-number="3"></a>
<a class="sourceLine" id="cb261-4" data-line-number="4"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(columns)) {</a>
<a class="sourceLine" id="cb261-5" data-line-number="5">  nyc_means[i] =<span class="st"> </span><span class="kw">mean</span>(weather[ ,columns[i]], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb261-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb261-7" data-line-number="7"></a>
<a class="sourceLine" id="cb261-8" data-line-number="8">nyc_means</a></code></pre></div>
<pre><code>[1] 55.260392127 62.530058972 10.517488384  0.004469079</code></pre>
<p>By creating a <span class="objclass">columns</span> object, if anything changes about the columns we want, that’s the only line in the code that would need to be changed. The <code>i</code> is now a place holder for a number that goes from 1 to the length of <span class="objclass">columns</span> (i.e. 4). We make an empty <span class="objclass">nyc_means</span> object that’s the length of the columns, so that each element will eventually be the mean of the corresponding column.</p>
<p>In the following I remove precipitation and add visibility and air pressure.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb263-1" data-line-number="1">columns =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;temp&#39;</span>, <span class="st">&#39;humid&#39;</span>, <span class="st">&#39;wind_speed&#39;</span>, <span class="st">&#39;visib&#39;</span>, <span class="st">&#39;pressure&#39;</span>)</a>
<a class="sourceLine" id="cb263-2" data-line-number="2">nyc_means =<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, <span class="kw">length</span>(columns))</a>
<a class="sourceLine" id="cb263-3" data-line-number="3"></a>
<a class="sourceLine" id="cb263-4" data-line-number="4"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(columns)) {</a>
<a class="sourceLine" id="cb263-5" data-line-number="5">  nyc_means[i] =<span class="st"> </span><span class="kw">mean</span>(weather[ ,columns[i]], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb263-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb263-7" data-line-number="7"></a>
<a class="sourceLine" id="cb263-8" data-line-number="8">nyc_means <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>[1]   55.26   62.53   10.52    9.26 1017.90</code></pre>
<p>Had we been copy-pasting, this would require deleting or commenting out a line in our code, pasting two more, and changing each one after pasting to represent the new columns. That’s tedious, and not a fun way to code.</p>
<div id="a-slight-speed-gain" class="section level4">
<h4>A slight speed gain</h4>
<p>Note that you do not have to create an empty object like we did. The following works also.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb265-1" data-line-number="1">columns =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;temp&#39;</span>,<span class="st">&#39;humid&#39;</span>,<span class="st">&#39;wind_speed&#39;</span>, <span class="st">&#39;visib&#39;</span>, <span class="st">&#39;pressure&#39;</span>)</a>
<a class="sourceLine" id="cb265-2" data-line-number="2">nyc_means =<span class="st"> </span><span class="kw">c</span>()</a>
<a class="sourceLine" id="cb265-3" data-line-number="3"></a>
<a class="sourceLine" id="cb265-4" data-line-number="4"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(columns)) {</a>
<a class="sourceLine" id="cb265-5" data-line-number="5">  nyc_means[i] =<span class="st"> </span><span class="kw">mean</span>(weather[ ,columns[i]], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb265-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb265-7" data-line-number="7"></a>
<a class="sourceLine" id="cb265-8" data-line-number="8">nyc_means <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>[1]   55.26   62.53   10.52    9.26 1017.90</code></pre>
<p>However, the other approach is slightly faster, because memory is already allocated for all elements of <span class="objclass">nyc_means</span>, rather than updating it every iteration of the loop. This speed gain can become noticeable when dealing with thousands of columns and complex operations.</p>
</div>
</div>
<div id="while-alternative" class="section level3">
<h3>While alternative</h3>
<p>When you look at some people’s R code, you may see a loop of a different sort.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb267-1" data-line-number="1">columns =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;temp&#39;</span>,<span class="st">&#39;humid&#39;</span>,<span class="st">&#39;wind_speed&#39;</span>, <span class="st">&#39;visib&#39;</span>, <span class="st">&#39;pressure&#39;</span>)</a>
<a class="sourceLine" id="cb267-2" data-line-number="2">nyc_means =<span class="st"> </span><span class="kw">c</span>()</a>
<a class="sourceLine" id="cb267-3" data-line-number="3"></a>
<a class="sourceLine" id="cb267-4" data-line-number="4">i =<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb267-5" data-line-number="5"><span class="cf">while</span> (i <span class="op">&lt;=</span><span class="st"> </span><span class="kw">length</span>(columns)) {</a>
<a class="sourceLine" id="cb267-6" data-line-number="6">  nyc_means[i] =<span class="st"> </span><span class="kw">mean</span>(weather[ ,columns[i]], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb267-7" data-line-number="7">  i =<span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb267-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb267-9" data-line-number="9"></a>
<a class="sourceLine" id="cb267-10" data-line-number="10">nyc_means <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>[1]   55.26   62.53   10.52    9.26 1017.90</code></pre>
<p>This involves a <span class="emph">while</span> statement. It states, while <code>i</code> is less than or equal to the length (number) of <span class="objclass">columns</span>, compute the value of the i<sup>th</sup> element of <span class="objclass">nyc_means</span> as the mean of i<sup>th</sup> column of <span class="objclass">weather</span>. After that, increase the value of <code>i</code>. So, we start with <code>i = 1</code>, compute that subsequent mean, <code>i</code> now equals 2, do the process again, and so on. The process will stop as soon as the value of <code>i</code> is greater than the length of <span class="objclass">columns</span>.</p>
<p><em>There is zero difference to using the while approach vs. the for loop</em>. While is often used when there is a check to be made, e.g. in modeling functions that have to stop the estimation process at some point, or else they’d go on indefinitely. In that case the while syntax is probably more natural. Either is fine.</p>
</div>
<div id="dots-and-loops" class="section level3">
<h3>(Dots and) Loops</h3>
<p>Understanding loops is fundamental toward spending less time processing data and more time toward exploring it. Your code will be more succinct and more able to handle the usual changes that come with dealing with data. Now that you have a sense of it, know that once you are armed with the sorts of things we’ll be talking about next- apply functions, writing functions, and vectorization - you’ll likely have little need to write explicit loops. While there is always a need for iterative processing of data, R provides even more efficient means to do so.</p>
</div>
<div id="apply-family" class="section level3">
<h3>apply family</h3>
<p>A family of functions comes with R that allows for a succinct way of looping when it is appropriate. As such, even when you loop in R, you don’t have to do so explicitly. Common functions in this family include:</p>
<ul>
<li><span class="func">apply</span>
<ul>
<li>arrays, matrices, data.frames</li>
</ul></li>
<li><span class="func">lapply</span>, <span class="func">sapply</span>, <span class="func">vapply</span>
<ul>
<li>lists, data.frames, vectors</li>
</ul></li>
<li><span class="func">tapply</span>
<ul>
<li>grouped operations (table apply)</li>
</ul></li>
<li><span class="func">mapply</span>
<ul>
<li>multivariate version of sapply</li>
</ul></li>
<li><span class="func">replicate</span>
<ul>
<li>performs an operation N times</li>
</ul></li>
</ul>
<p>As an example we’ll consider standardizing variables, i.e. taking a set of numbers, subtracting the mean, and dividing by the standard deviation. This results in a variable with mean of 0 and standard deviation of 1. Let’s start with a loop approach.</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb269-1" data-line-number="1"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(mydf)){</a>
<a class="sourceLine" id="cb269-2" data-line-number="2">  x =<span class="st"> </span>mydf[,i]</a>
<a class="sourceLine" id="cb269-3" data-line-number="3">  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(x)){</a>
<a class="sourceLine" id="cb269-4" data-line-number="4">    x[j] =<span class="st"> </span>(x[j] <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(x))<span class="op">/</span><span class="kw">sd</span>(x)</a>
<a class="sourceLine" id="cb269-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb269-6" data-line-number="6">}</a></code></pre></div>
<p>The above would be a really bad way to use R. It goes over each column individually, then over each value of the column.</p>
<p>Conversely, <span class="func">apply</span> will take a matrix or data frame, and apply a function over the margin, row or column, you want to loop over. The first argument is the data you’re considering, the margin is the second argument (1 for rows, 2 for columns<a href="#fn22" class="footnote-ref" id="fnref22"><sup>22</sup></a>), and the function you want to apply to those rows is the third argument. The following example is much cleaner compared to the loop, and now you’d have a function you can use elsewhere if needed.</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb270-1" data-line-number="1">stdize &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb270-2" data-line-number="2">  (x<span class="op">-</span><span class="kw">mean</span>(x)) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(x)</a>
<a class="sourceLine" id="cb270-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb270-4" data-line-number="4"></a>
<a class="sourceLine" id="cb270-5" data-line-number="5"><span class="kw">apply</span>(mydf, <span class="dv">2</span>, stdize)   <span class="co"># 1 for rows, 2 for columnwise application</span></a></code></pre></div>
<p>Many of the other apply functions work similarly, taking an object and a function to do the work on the object (possibly implicit), possibly with other arguments specified if necessary.</p>
<div id="apply-functions" class="section level4">
<h4>Apply functions</h4>
<p>It is important to be familiar with and regularly use the apply family for efficient data processing. A summary of benefits includes:</p>
<ul>
<li>Cleaner/simpler code</li>
<li>Environment kept clear of unnecessary objects</li>
<li>Potentially more reproducible
<ul>
<li>more likely to use generalizable functions</li>
</ul></li>
<li>Parallelizable</li>
</ul>
<p>Note that apply functions are <span class="emph">NOT</span> necessarily faster than explicit loops, and if you create an empty object for the loop as discussed previously, the explicit loop will likely be faster. On top of that, functions like <span class="func">replicate</span> and <span class="func">mapply</span> are especially slow.</p>
<p>However, the apply family can ALWAYS <em>potentially</em> be faster than standard R loops do to parallelization. With base R’s <span class="pack">parallel</span> package, there are parallel versions of the apply family, e.g.<span class="func">parApply</span>, <span class="func">parLapply</span> etc. As every modern computer has at least four cores to play with, you’ll always potentially have nearly a 4x speedup by using the parallel apply functions.</p>
<p>Apply functions and similar approaches should be a part of your regular R experience. We’ll talk about other options that may have even more benefits, but you need to know the basics of how apply functions work in order to use those.</p>
<div class="note">
<p>I use R every day, and very rarely use explicit loops. Note that there is no speed difference for a <span class="func">for</span> loop vs. using <span class="func">while</span>. And if you must use an explicit loop, create an empty object of the dimension/form you need, and then fill it in via the loop. This will be notably faster.</p>
<p>I pretty much never use an explicit double loop, as a little more thinking about the problem will usually provide a more efficient path to solving the problem.</p>
<p><img class='img-note' src="img/R.ico" style="display:block; margin: 0 auto;"></p>
</div>
</div>
</div>
<div id="purrr" class="section level3">
<h3>purrr</h3>
<p>The <span class="pack">purr</span> package allows you to take the <span class="func">apply</span> family approach to the tidyverse.</p>
<p>Consider the following. We’ll use the <span class="func">map</span> function to map the <span class="func">sum</span> function to each element in the list, the same way we would with <span class="func">lapply</span>.</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb271-1" data-line-number="1">x =<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">4</span><span class="op">:</span><span class="dv">6</span>, <span class="dv">7</span><span class="op">:</span><span class="dv">9</span>)</a>
<a class="sourceLine" id="cb271-2" data-line-number="2"><span class="kw">map</span>(x, sum)</a></code></pre></div>
<pre><code>[[1]]
[1] 6

[[2]]
[1] 15

[[3]]
[1] 24</code></pre>
<p>The map functions take some getting used to, and in my experience they are typically slower than the apply functions, sometimes notably so. However they allow you stay within the tidy realm, which has its own benefits, and have more control over the nature of the output<a href="#fn23" class="footnote-ref" id="fnref23"><sup>23</sup></a>, which is especially important in reproducibility, package development, producing production-level code, etc. The key idea is that the map functions will always return something the same length as the input given to it.</p>
<p>The <span class="pack">purrr</span> functions want a list or vector, i.e. they don’t work with data.frame objects like we’ve done with mutate and summarize except in the sense that data.frames are lists.</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb273-1" data-line-number="1">## mtcars %&gt;% </a>
<a class="sourceLine" id="cb273-2" data-line-number="2">##   map(scale)    # returns a list, not shown</a>
<a class="sourceLine" id="cb273-3" data-line-number="3"></a>
<a class="sourceLine" id="cb273-4" data-line-number="4">mtcars <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb273-5" data-line-number="5"><span class="st">  </span><span class="kw">map_df</span>(scale) <span class="co"># returns a df</span></a></code></pre></div>
<pre><code># A tibble: 32 x 11
      mpg    cyl    disp     hp   drat       wt   qsec     vs     am   gear   carb
    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1  0.151 -0.105 -0.571  -0.535  0.568 -0.610   -0.777 -0.868  1.19   0.424  0.735
 2  0.151 -0.105 -0.571  -0.535  0.568 -0.350   -0.464 -0.868  1.19   0.424  0.735
 3  0.450 -1.22  -0.990  -0.783  0.474 -0.917    0.426  1.12   1.19   0.424 -1.12 
 4  0.217 -0.105  0.220  -0.535 -0.966 -0.00230  0.890  1.12  -0.814 -0.932 -1.12 
 5 -0.231  1.01   1.04    0.413 -0.835  0.228   -0.464 -0.868 -0.814 -0.932 -0.503
 6 -0.330 -0.105 -0.0462 -0.608 -1.56   0.248    1.33   1.12  -0.814 -0.932 -1.12 
 7 -0.961  1.01   1.04    1.43  -0.723  0.361   -1.12  -0.868 -0.814 -0.932  0.735
 8  0.715 -1.22  -0.678  -1.24   0.175 -0.0278   1.20   1.12  -0.814  0.424 -0.503
 9  0.450 -1.22  -0.726  -0.754  0.605 -0.0687   2.83   1.12  -0.814  0.424 -0.503
10 -0.148 -0.105 -0.509  -0.345  0.605  0.228    0.253  1.12  -0.814  0.424  0.735
# ... with 22 more rows</code></pre>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb275-1" data-line-number="1">mtcars <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb275-2" data-line-number="2"><span class="st">  </span><span class="kw">map_dbl</span>(sum)  <span class="co"># returns a numeric (double) vector of column sums</span></a></code></pre></div>
<pre><code>     mpg      cyl     disp       hp     drat       wt     qsec       vs       am     gear     carb 
 642.900  198.000 7383.100 4694.000  115.090  102.952  571.160   14.000   13.000  118.000   90.000 </code></pre>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb277-1" data-line-number="1">diamonds <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb277-2" data-line-number="2"><span class="st">  </span><span class="kw">map_at</span>(<span class="kw">c</span>(<span class="st">&#39;carat&#39;</span>, <span class="st">&#39;depth&#39;</span>, <span class="st">&#39;price&#39;</span>), </a>
<a class="sourceLine" id="cb277-3" data-line-number="3">         <span class="cf">function</span>(x) <span class="kw">as.integer</span>(x <span class="op">&gt;</span><span class="st"> </span><span class="kw">median</span>(x))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb277-4" data-line-number="4"><span class="st">  </span><span class="kw">as_data_frame</span>()</a></code></pre></div>
<pre><code># A tibble: 53,940 x 10
   carat cut       color clarity depth table price     x     y     z
   &lt;int&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1     0 Ideal     E     SI2         0    55     0  3.95  3.98  2.43
 2     0 Premium   E     SI1         0    61     0  3.89  3.84  2.31
 3     0 Good      E     VS1         0    65     0  4.05  4.07  2.31
 4     0 Premium   I     VS2         1    58     0  4.2   4.23  2.63
 5     0 Good      J     SI2         1    58     0  4.34  4.35  2.75
 6     0 Very Good J     VVS2        1    57     0  3.94  3.96  2.48
 7     0 Very Good I     VVS1        1    57     0  3.95  3.98  2.47
 8     0 Very Good H     SI1         1    55     0  4.07  4.11  2.53
 9     0 Fair      E     VS2         1    61     0  3.87  3.78  2.49
10     0 Very Good H     VS1         0    61     0  4     4.05  2.39
# ... with 53,930 more rows</code></pre>
<p>However, working with lists is very useful, so let’s turn to that.</p>
</div>
<div id="working-with-lists" class="section level3">
<h3>Working with lists</h3>
<p>Aside from data frames, you may think you don’t have much need for list objects. However, list objects make it very easy to iterate some form of data processing.</p>
<p>Let’s say you have models of increasing complexity, and you want to easily summarise and/or compare them.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb279-1" data-line-number="1"><span class="kw">library</span>(mgcv) <span class="co"># for gam</span></a>
<a class="sourceLine" id="cb279-2" data-line-number="2">mtcars<span class="op">$</span>cyl =<span class="st"> </span><span class="kw">factor</span>(mtcars<span class="op">$</span>cyl)</a>
<a class="sourceLine" id="cb279-3" data-line-number="3">mod_lm =<span class="st"> </span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>wt, <span class="dt">data=</span>mtcars)</a>
<a class="sourceLine" id="cb279-4" data-line-number="4">mod_poly =<span class="st"> </span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(wt, <span class="dv">2</span>), <span class="dt">data=</span>mtcars)</a>
<a class="sourceLine" id="cb279-5" data-line-number="5">mod_inter =<span class="st"> </span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>wt<span class="op">*</span>cyl, <span class="dt">data=</span>mtcars)</a>
<a class="sourceLine" id="cb279-6" data-line-number="6">mod_gam =<span class="st"> </span><span class="kw">gam</span>(mpg <span class="op">~</span><span class="st"> </span><span class="kw">s</span>(wt), <span class="dt">data=</span>mtcars)</a>
<a class="sourceLine" id="cb279-7" data-line-number="7">mod_gam_inter =<span class="st"> </span><span class="kw">gam</span>(mpg <span class="op">~</span><span class="st"> </span>cyl <span class="op">+</span><span class="st"> </span><span class="kw">s</span>(wt, <span class="dt">by=</span>cyl), <span class="dt">data=</span>mtcars)</a>
<a class="sourceLine" id="cb279-8" data-line-number="8"></a>
<a class="sourceLine" id="cb279-9" data-line-number="9">model_list =<span class="st"> </span><span class="kw">list</span>(<span class="dt">mod_lm =</span> mod_lm,</a>
<a class="sourceLine" id="cb279-10" data-line-number="10">                  <span class="dt">mod_poly =</span> mod_poly,</a>
<a class="sourceLine" id="cb279-11" data-line-number="11">                  <span class="dt">mod_inter =</span> mod_inter,</a>
<a class="sourceLine" id="cb279-12" data-line-number="12">                  <span class="dt">mod_gam =</span> mod_gam,</a>
<a class="sourceLine" id="cb279-13" data-line-number="13">                  <span class="dt">mod_gam_inter =</span> mod_gam_inter)</a>
<a class="sourceLine" id="cb279-14" data-line-number="14"></a>
<a class="sourceLine" id="cb279-15" data-line-number="15"><span class="co"># lowest wins</span></a>
<a class="sourceLine" id="cb279-16" data-line-number="16">model_list <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb279-17" data-line-number="17"><span class="st">  </span><span class="kw">map_dbl</span>(AIC) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb279-18" data-line-number="18"><span class="st">  </span><span class="kw">sort</span>()</a></code></pre></div>
<pre><code>mod_gam_inter     mod_inter      mod_poly       mod_gam        mod_lm 
     150.6324      155.4811      158.0484      158.5717      166.0294 </code></pre>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb281-1" data-line-number="1"><span class="co"># highest wins</span></a>
<a class="sourceLine" id="cb281-2" data-line-number="2">model_list <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb281-3" data-line-number="3"><span class="st">  </span><span class="kw">map_dbl</span>(<span class="cf">function</span>(x) <span class="kw">if_else</span>(<span class="kw">inherits</span>(x, <span class="st">&#39;gam&#39;</span>),</a>
<a class="sourceLine" id="cb281-4" data-line-number="4">                              <span class="kw">summary</span>(x)<span class="op">$</span>r.sq,</a>
<a class="sourceLine" id="cb281-5" data-line-number="5">                              <span class="kw">summary</span>(x)<span class="op">$</span>adj)</a>
<a class="sourceLine" id="cb281-6" data-line-number="6">          ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb281-7" data-line-number="7"><span class="st">  </span><span class="kw">sort</span>(<span class="dt">decreasing =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>mod_gam_inter     mod_inter      mod_poly       mod_gam        mod_lm 
    0.8643020     0.8349382     0.8065828     0.8041651     0.7445939 </code></pre>
<p>Let’s go further and create a plot of these results. We’ll map to a data frame, use gather to melt it to two columns of model and value, then use ggplot2 to plot the results<a href="#fn24" class="footnote-ref" id="fnref24"><sup>24</sup></a>.</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb283-1" data-line-number="1">model_list <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb283-2" data-line-number="2"><span class="st">  </span><span class="kw">map_df</span>(<span class="cf">function</span>(x) <span class="kw">if_else</span>(<span class="kw">inherits</span>(x, <span class="st">&#39;gam&#39;</span>),</a>
<a class="sourceLine" id="cb283-3" data-line-number="3">                             <span class="kw">summary</span>(x)<span class="op">$</span>r.sq,</a>
<a class="sourceLine" id="cb283-4" data-line-number="4">                             <span class="kw">summary</span>(x)<span class="op">$</span>adj)</a>
<a class="sourceLine" id="cb283-5" data-line-number="5">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb283-6" data-line-number="6"><span class="st">  </span><span class="kw">gather</span>(<span class="dt">key =</span> <span class="st">&#39;model&#39;</span>, <span class="dt">value =</span> <span class="st">`</span><span class="dt">Adj. Rsq</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb283-7" data-line-number="7"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(<span class="st">`</span><span class="dt">Adj. Rsq</span><span class="st">`</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb283-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="kw">factor</span>(model, <span class="dt">levels =</span> model)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># sigh</span></a>
<a class="sourceLine" id="cb283-9" data-line-number="9"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>model, <span class="dt">y=</span><span class="st">`</span><span class="dt">Adj. Rsq</span><span class="st">`</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb283-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color=</span>model), <span class="dt">size=</span><span class="dv">10</span>, <span class="dt">show.legend =</span> F)</a></code></pre></div>
<p><img src="data-processing-and-visualization_files/figure-html/purr_models2-1.svg" width="75%" style="display: block; margin: auto;" /></p>
<p>Why not throw in AIC also?</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb284-1" data-line-number="1">mod_rsq =<span class="st"> </span></a>
<a class="sourceLine" id="cb284-2" data-line-number="2"><span class="st">  </span>model_list <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb284-3" data-line-number="3"><span class="st">  </span><span class="kw">map_df</span>(<span class="cf">function</span>(x) <span class="kw">if_else</span>(<span class="kw">inherits</span>(x, <span class="st">&#39;gam&#39;</span>),</a>
<a class="sourceLine" id="cb284-4" data-line-number="4">                             <span class="kw">summary</span>(x)<span class="op">$</span>r.sq,</a>
<a class="sourceLine" id="cb284-5" data-line-number="5">                             <span class="kw">summary</span>(x)<span class="op">$</span>adj)</a>
<a class="sourceLine" id="cb284-6" data-line-number="6">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb284-7" data-line-number="7"><span class="st">  </span><span class="kw">gather</span>(<span class="dt">key =</span> <span class="st">&#39;model&#39;</span>, <span class="dt">value=</span><span class="st">&#39;Rsq&#39;</span>)</a>
<a class="sourceLine" id="cb284-8" data-line-number="8"></a>
<a class="sourceLine" id="cb284-9" data-line-number="9">mod_aic =</a>
<a class="sourceLine" id="cb284-10" data-line-number="10"><span class="st">  </span><span class="kw">map_df</span>(model_list, AIC) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb284-11" data-line-number="11"><span class="st">  </span><span class="kw">gather</span>(<span class="dt">key=</span><span class="st">&#39;model&#39;</span>, <span class="dt">value=</span><span class="st">&#39;AIC&#39;</span>)</a>
<a class="sourceLine" id="cb284-12" data-line-number="12"></a>
<a class="sourceLine" id="cb284-13" data-line-number="13"><span class="kw">left_join</span>(mod_rsq, mod_aic) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb284-14" data-line-number="14"><span class="st">  </span><span class="kw">arrange</span>(AIC) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb284-15" data-line-number="15"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="kw">factor</span>(model, <span class="dt">levels =</span> model)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb284-16" data-line-number="16"><span class="st">  </span><span class="kw">gather</span>(<span class="dt">key =</span> <span class="st">&#39;measure&#39;</span>, <span class="dt">value=</span><span class="st">&#39;value&#39;</span>, <span class="op">-</span>model) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb284-17" data-line-number="17"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>model, <span class="dt">y=</span>value)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb284-18" data-line-number="18"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color=</span>model), <span class="dt">size=</span><span class="dv">10</span>, <span class="dt">show.legend =</span> F) <span class="op">+</span></a>
<a class="sourceLine" id="cb284-19" data-line-number="19"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>measure, <span class="dt">scales =</span> <span class="st">&#39;free&#39;</span>)</a></code></pre></div>
<p><img src="data-processing-and-visualization_files/figure-html/purr_models3-1.svg" width="75%" style="display: block; margin: auto;" /></p>
<div id="list-columns" class="section level5">
<h5>List columns</h5>
<p>As data.frames are lists, anything can be put into a column just as you would a list element. We’ll use <span class="func">pmap</span> here, as it can take more than one argument, and we’re feeding all columns of the data.frame.</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb285-1" data-line-number="1">mtcars2 =<span class="st"> </span><span class="kw">as.matrix</span>(mtcars)</a>
<a class="sourceLine" id="cb285-2" data-line-number="2">mtcars2[<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(mtcars2),<span class="dv">50</span>)] =<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb285-3" data-line-number="3">mtcars2 =<span class="st"> </span><span class="kw">as_data_frame</span>(mtcars2)</a>
<a class="sourceLine" id="cb285-4" data-line-number="4"></a>
<a class="sourceLine" id="cb285-5" data-line-number="5">mtcars2 =<span class="st"> </span>mtcars2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb285-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">newvar =</span> <span class="kw">pmap</span>(., <span class="op">~</span><span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb285-7" data-line-number="7">    <span class="dt">N =</span> <span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(<span class="kw">c</span>(...))),</a>
<a class="sourceLine" id="cb285-8" data-line-number="8">    <span class="dt">Miss =</span> <span class="kw">sum</span>(<span class="kw">is.na</span>(<span class="kw">c</span>(...)))</a>
<a class="sourceLine" id="cb285-9" data-line-number="9">  )))</a></code></pre></div>
<p>Now check out the list column.</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb286-1" data-line-number="1">mtcars2</a></code></pre></div>
<pre><code># A tibble: 32 x 12
   mpg   cyl   disp  hp    drat  wt    qsec  vs    am    gear  carb  newvar              
   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;list&gt;              
 1 21.0  6     160.0 110   3.90  2.620 16.46 0     1     4     &lt;NA&gt;  &lt;data.frame [1 × 2]&gt;
 2 21.0  6     160.0 &lt;NA&gt;  3.90  2.875 17.02 0     1     4     4     &lt;data.frame [1 × 2]&gt;
 3 &lt;NA&gt;  &lt;NA&gt;  108.0 &quot; 93&quot; 3.85  2.320 18.61 1     1     4     &lt;NA&gt;  &lt;data.frame [1 × 2]&gt;
 4 21.4  6     &lt;NA&gt;  110   &lt;NA&gt;  3.215 19.44 1     0     3     1     &lt;data.frame [1 × 2]&gt;
 5 18.7  8     &lt;NA&gt;  175   3.15  3.440 17.02 0     0     &lt;NA&gt;  2     &lt;data.frame [1 × 2]&gt;
 6 18.1  6     225.0 105   2.76  3.460 &lt;NA&gt;  1     0     3     1     &lt;data.frame [1 × 2]&gt;
 7 &lt;NA&gt;  8     360.0 &lt;NA&gt;  &lt;NA&gt;  3.570 &lt;NA&gt;  0     0     &lt;NA&gt;  4     &lt;data.frame [1 × 2]&gt;
 8 24.4  4     146.7 &quot; 62&quot; 3.69  3.190 20.00 &lt;NA&gt;  &lt;NA&gt;  4     2     &lt;data.frame [1 × 2]&gt;
 9 22.8  &lt;NA&gt;  140.8 &quot; 95&quot; 3.92  3.150 22.90 1     0     4     2     &lt;data.frame [1 × 2]&gt;
10 19.2  6     167.6 123   3.92  &lt;NA&gt;  18.30 1     0     4     4     &lt;data.frame [1 × 2]&gt;
# ... with 22 more rows</code></pre>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb288-1" data-line-number="1">mtcars2<span class="op">$</span>newvar <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">3</span>)</a></code></pre></div>
<pre><code>[[1]]
   N Miss
1 10    1

[[2]]
   N Miss
1 10    1

[[3]]
  N Miss
1 8    3</code></pre>
<p>Unnest it with the <span class="pack">tidyr</span> function.</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb290-1" data-line-number="1">mtcars2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb290-2" data-line-number="2"><span class="st">  </span><span class="kw">unnest</span>(newvar)</a></code></pre></div>
<pre><code># A tibble: 32 x 13
   mpg   cyl   disp  hp    drat  wt    qsec  vs    am    gear  carb      N  Miss
   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt;
 1 21.0  6     160.0 110   3.90  2.620 16.46 0     1     4     &lt;NA&gt;     10     1
 2 21.0  6     160.0 &lt;NA&gt;  3.90  2.875 17.02 0     1     4     4        10     1
 3 &lt;NA&gt;  &lt;NA&gt;  108.0 &quot; 93&quot; 3.85  2.320 18.61 1     1     4     &lt;NA&gt;      8     3
 4 21.4  6     &lt;NA&gt;  110   &lt;NA&gt;  3.215 19.44 1     0     3     1         9     2
 5 18.7  8     &lt;NA&gt;  175   3.15  3.440 17.02 0     0     &lt;NA&gt;  2         9     2
 6 18.1  6     225.0 105   2.76  3.460 &lt;NA&gt;  1     0     3     1        10     1
 7 &lt;NA&gt;  8     360.0 &lt;NA&gt;  &lt;NA&gt;  3.570 &lt;NA&gt;  0     0     &lt;NA&gt;  4         6     5
 8 24.4  4     146.7 &quot; 62&quot; 3.69  3.190 20.00 &lt;NA&gt;  &lt;NA&gt;  4     2         9     2
 9 22.8  &lt;NA&gt;  140.8 &quot; 95&quot; 3.92  3.150 22.90 1     0     4     2        10     1
10 19.2  6     167.6 123   3.92  &lt;NA&gt;  18.30 1     0     4     4        10     1
# ... with 22 more rows</code></pre>
<p>This is a pretty esoteric demonstration, and not something you’d normally want to do, as <span class="func">mutate</span> or other approaches would be far more efficient and sensical. However, the idea is that you might want to retain the information you might otherwise store in a list with the data that was used to create it. Once you have that, you can use that column as you would any list for iterative programming.</p>
</div>
</div>
<div id="iterative-programming-exercises" class="section level3">
<h3>Iterative Programming Exercises</h3>
<div id="exercise-1-7" class="section level4">
<h4>Exercise 1</h4>
<p>With the following <span class="objclass">matrix</span>, use <span class="func">apply</span> and the <span class="func">sum</span> function to get row or column sums.</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb292-1" data-line-number="1">x =<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>, <span class="dv">3</span>, <span class="dv">3</span>)</a></code></pre></div>
</div>
<div id="exercise-2-7" class="section level4">
<h4>Exercise 2</h4>
<p>With the following <span class="objclass">list</span>, use <span class="func">lapply</span> and <span class="func">sapply</span> and the <span class="func">sum</span> function to get sums for the elements. There is no margin to specify for a list, so just supply the list and the sum function.</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb293-1" data-line-number="1">x =<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">4</span><span class="op">:</span><span class="dv">6</span>, <span class="dv">7</span><span class="op">:</span><span class="dv">9</span>)</a></code></pre></div>
</div>
<div id="exercise-3-3" class="section level4">
<h4>Exercise 3</h4>
<p>As in the previous example, use a map function to create a data frame of the column means.</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb294-1" data-line-number="1">d =<span class="st"> </span><span class="kw">data_frame</span>(</a>
<a class="sourceLine" id="cb294-2" data-line-number="2">  <span class="dt">x =</span> <span class="kw">rnorm</span>(<span class="dv">100</span>),</a>
<a class="sourceLine" id="cb294-3" data-line-number="3">  <span class="dt">y =</span> <span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">10</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb294-4" data-line-number="4">  <span class="dt">z =</span> <span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">50</span>, <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb294-5" data-line-number="5">)</a></code></pre></div>
<p><span class="func">sapply</span> is actually just a wrapper for <span class="func">lapply</span>. If you supply the argument <code>simplified=F</code>, it is identical. Otherwise, it attempts to return a vector or matrix.</p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="21">
<li id="fn21"><p>Note that weather data frame is originally a <span class="objclass">tbl</span> (tibble) class object, and that loop code won’t work with it unless it’s converted to a real data frame, because tibbles are annoying like that. You would have to do something like <code>weather %&gt;% pull(column)</code>.<a href="3_02_iterative.html#fnref21" class="footnote-back">↩</a></p></li>
<li id="fn22"><p>You can have 3 or more dimensional arrays, and <span class="func">apply</span> will work over those dimensions (or any combination of them), but this doesn’t come up too often.<a href="3_02_iterative.html#fnref22" class="footnote-back">↩</a></p></li>
<li id="fn23"><p>Personally I find the help file description nebulous or completely lacking, and the examples unrealistic, and oftentimes can come up with a group_by-summarise approach before I can sort out why the map approach didn’t work.<a href="3_02_iterative.html#fnref23" class="footnote-back">↩</a></p></li>
<li id="fn24"><p>Note that ggplot2 will change the ordering of the variable unless you coerce it by creating a factor. This pretty much defeats the entire purpose of retaining characters over factors everywhere else in the tidyverse.<a href="3_02_iterative.html#fnref24" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="3_01_programming.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="3_03_functions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["twitter", "facebook", "google", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"download": null,
"toc": {
"collapse": "section",
"depth": 3,
"scroll_highlight": true
},
"highlight": "pygments",
"search": true
});
});
</script>

</body>

</html>
